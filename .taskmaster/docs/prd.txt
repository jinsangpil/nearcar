<context>
# Overview  
니어카 통합 플랫폼은 "고객이 중고차를 사기 전, 3분 안에 신청 → 당일 기사 배정 → 진단 후 1시간 내 레포트 수령"을 가능하게 하는 **중고차 온라인 진단 플랫폼**입니다.

현재 "홈페이지 + 구글폼 + 슬랙 + 채널톡"으로 분산되어 있는 업무 프로세스를 단일 웹 시스템으로 통합하여 운영 효율성을 극대화하고 고객 경험을 개선하는 것이 목표입니다.

이 플랫폼은 중고차 구매 전 진단이 필요한 고객, 진단 서비스를 제공하는 전문 기사, 그리고 전체 프로세스를 관리하는 운영진을 연결하는 핵심 인프라 역할을 합니다.

# Core Features  

## 고객 기능
- **비회원 신청 및 인증**: 전화번호 인증을 통한 간편 신청 프로세스
- **진단 신청 및 결제**: 차량 정보 입력(국토교통부 API 연동), 패키지 선택, 결제 처리
- **실시간 상태 조회**: 신청부터 진단 완료까지의 전체 프로세스 실시간 추적
- **레포트 열람 및 다운로드**: PDF 형식의 진단 레포트 열람 및 다운로드
- **후기 작성**: 별점 및 코멘트를 통한 기사 평가

## 기사 기능
- **대시보드 및 일정 관리**: 배정된 진단 일정 확인 및 수락/거절
- **진단 체크리스트 작성**: 사고유무, 엔진룸, 하부, 미션, 전장품, 타이어 등 체계적 진단 입력
- **미디어 업로드**: 사진 및 영상 업로드 (모바일 최적화)
- **레포트 작성 및 제출**: 진단 결과 기반 레포트 작성 및 자동 발송
- **정산 내역 조회**: 건별 및 월별 정산 내역 확인

## 운영자/관리자 기능
- **신청 관리**: 전체 신청 리스트 조회, 필터링, 상세 관리
- **기사 배정**: 수동 배정 및 자동 배정 시스템 (V1에서는 수동, V2에서 자동화)
- **고객/기사 계정 관리**: 사용자 계정 생성, 수정, 권한 관리
- **패키지 관리**: 진단 패키지(풀패키지, 라이트 A/B/C) 등록 및 관리
- **자동차 정보 관리**: 차종별 정보 및 스크래핑 데이터 관리
- **차종별 금액 관리**: 국산/수입 차종별 진단 가격 설정
- **서비스 지역 관리**: 지역별 서비스 제공 및 추가 요금 설정
- **정산 관리**: 기사별 매출, 수수료 계산, 정산 상태 관리 및 엑셀 다운로드
- **통계 대시보드**: 신청, 결제, 매출, 배정 현황 및 유입경로 통계
- **클레임 및 환불 처리**: 고객 클레임 처리 및 환불 관리

## 외부 API 연동
- **국토교통부 API**: 차량번호 기반 차량 기본정보 조회
- **car365 API**: 매매용 차량 조회, 침수차량 조회, 시세/사진/옵션 정보
- **알림톡/SMS/이메일**: 카카오 알림톡, SMS, 이메일 발송
- **슬랙 알림**: 운영진 알림 연동

# User Experience  

## 사용자 유형 및 권한

### 고객(Client)
- 회원가입 또는 비회원(전화번호 인증) 신청
- 진단 신청 / 옵션 선택 / 결제
- 신청 상태 조회
- 레포트 열람 및 다운로드(PDF)
- 후기 작성(별점 + 코멘트)

### 진단기사(Inspector)
- 로그인 후 개인 대시보드 이용
- 배정된 일정 확인 / 수락·거절
- 고객 연락처 조회
- 진단 체크리스트 작성
- 사진·영상 업로드
- 레포트 작성 및 제출
- 정산 내역 조회(건별 / 월별)

### 내부직원(Staff)
- 신청 리스트 확인
- 자동배정 결과 검토 및 수동 수정
- 기사 수동 배정
- 상담/문의 메모 기록
- 클레임 처리 및 환불
- 레포트 재발송

### 운영자(Admin)
- 모든 Staff 기능 + 시스템 설정 전체 관리
- 매출/전환율 통계 조회
- 기사 등급/수수료율/활동지역 설정
- 패키지 가격 / 쿠폰 / 프로모션 관리
- 채널(유입경로) 통계 관리

## 주요 사용자 플로우

### 고객 신청 플로우
1. 웹/모바일웹 접속 → "중고차 진단 신청하기" 클릭
2. 차량 정보 입력 (차량번호 또는 차종/연식/주행거리/연료 - 국토교통부 API 연동)
3. 구매유형 선택 (매매단지 / 직거래 / 홈서비스차량)
4. 차량 위치 입력 (주소 + 지도검색)
5. 희망 날짜/시간대 선택
6. 진단방식 선택 (전문가와 동행 / 전문가만 보내기)
7. 검수 패키지 선택 (풀패키지, 라이트 A, 라이트 B, 라이트 C)
8. 본인정보 입력 및 인증 (이름/연락처/이메일)
9. 결제 (카드/계좌이체)
10. 완료 시 알림톡+SMS+이메일 수신

### 기사 배정 및 진단 플로우
1. 시스템이 기사에게 배정 요청 (V1: 수동 배정, V2: 자동 배정)
2. 기사가 수락/거절 (거절 시 사유 작성 및 운영자 알림)
3. 기사가 고객과 통화하여 시간·장소 확정
4. 현장 방문 후 체크리스트 기반 진단 수행
5. 사진 촬영 및 업로드
6. 진단 결과 입력 및 레포트 제출
7. 레포트 자동 생성 및 고객 발송

### 레포트 발송 플로우
1. 기사가 진단 결과 제출
2. 운영자 검토 (설정에 따라)
3. 최종 발송 승인
4. 고객 이메일 자동 발송 + 알림톡/SMS 알림
5. 고객 마이페이지에서 열람 가능

## UI/UX 고려사항
- 모바일 웹 최적화 (기사 현장 작업 환경 고려)
- 직관적인 단계별 진행 표시
- 실시간 상태 업데이트 및 알림
- 간편한 이미지 업로드 (모바일 카메라 연동)
- 반응형 디자인으로 다양한 디바이스 지원
</context>
<PRD>
# Technical Architecture  

## 시스템 컴포넌트

### 프론트엔드
- 웹 애플리케이션 (고객, 기사, 운영자 대시보드)
- 모바일 웹 최적화 (기사 현장 작업용)
- 반응형 디자인

### 백엔드
- RESTful API 서버
- 인증/인가 시스템 (JWT 기반)
- 파일 업로드 처리 (S3 또는 유사 객체 스토리지)
- 알림 발송 시스템 (알림톡, SMS, 이메일, 슬랙)

### 데이터베이스
- 사용자 정보 (고객, 기사, 운영자)
- 진단 신청 및 상태 관리
- 진단 결과 및 레포트 데이터
- 정산 정보
- 패키지 및 가격 정보
- 차량 정보 (스크래핑 데이터 포함)

### 외부 API 연동
- 국토교통부 API: 차량 기본정보 조회
- car365 API: 매매용 차량 조회, 침수차량 조회, 시세/사진/옵션
- 결제 API: 카드/계좌이체 결제 처리
- 알림톡 API: 카카오 알림톡 발송
- SMS API: SMS 발송 (알림톡 실패 시 fallback)
- 이메일 API: 이메일 발송
- 슬랙 API: 운영진 알림

## 데이터 모델 주요 엔티티

### 사용자
- 고객 (Client): 전화번호, 이메일, 인증 정보
- 기사 (Inspector): 계정 정보, 등급, 활동지역, 가능차종, 수수료율
- 운영자 (Staff/Admin): 계정 정보, 권한 레벨

### 진단 신청
- 신청 정보: 차량 정보, 위치, 희망 일정, 패키지 선택
- 결제 정보: 결제 금액, 결제 방법, 결제 상태
- 배정 정보: 배정된 기사, 배정 상태, 수락/거절 정보

### 진단 결과
- 체크리스트 데이터: 사고유무, 엔진룸, 하부, 미션, 전장품, 타이어 등
- 미디어 파일: 사진, 영상 (S3 저장)
- 레포트 데이터: 종합평가, 수리 권장 항목, 예상비용

### 정산
- 정산 기록: 기사별, 건별 정산 정보
- 수수료 계산: 기본 수수료율 및 기사별 수수료율 적용
- 정산 상태: 미정산/정산완료

### 시스템 설정
- 패키지 정보: 패키지 종류 및 포함 항목
- 차종별 금액: 국산/수입 차종별 가격 설정
- 서비스 지역: 지역별 서비스 제공 및 추가 요금
- 기사 수수료율: 기본 수수료율 및 기사별 수수료율

## 인프라 요구사항

### 성능
- 고객 신청 처리: 3초 이내 응답
- 레포트 자동 생성: 30초 이내
- 일일 5,000건 트래픽까지 대응 가능하도록 설계

### 보안
- JWT 기반 인증
- 파일 업로드는 S3 또는 유사 객체 스토리지
- 개인정보 암호화 저장
- HTTPS 통신

### 안정성
- 알림톡 실패 시 SMS fallback
- 10초 단위 배정 타임아웃 처리
- 데이터베이스 백업 및 복구 시스템

# Development Roadmap  

## V1 (MVP - 최소 기능 제품)

### 목표
핵심 프로세스가 동작하는 기본 시스템 구축. "홈페이지 + 구글폼 + 슬랙 + 채널톡"을 대체할 수 있는 최소 기능 구현.

### 고객 기능
- 비회원 신청 (전화번호 인증)
- 차량 정보 입력 (국토교통부 API 연동)
- 패키지 선택 및 결제
- 신청 상태 조회
- 레포트 열람 및 다운로드 (PDF)

### 기사 기능
- 계정 로그인
- 배정된 일정 확인 및 수락/거절
- 진단 체크리스트 작성 UI
- 이미지 업로드 (모바일 최적화)
- 레포트 작성 및 제출

### 운영자 기능
- 신청 리스트 조회 및 필터링
- 신청 상세보기
- 기사 수동 배정
- 상담/문의 메모 기록
- 클레임 처리 및 환불
- 레포트 재발송
- 기본 정산표 (엑셀 다운로드)

### 알림 시스템
- 알림톡 발송 (고객, 운영자)
- SMS 발송 (fallback)
- 이메일 발송
- 슬랙 알림 (운영진)

### 시스템 관리
- 고객/기사 계정 관리
- 패키지 관리 (기본 패키지 등록)
- 차종별 금액 설정 (기본 설정)
- 서비스 지역 관리 (기본 지역 등록)

## V2 (고도화)

### 자동화 및 스마트 기능
- 기사 자동 배정 시스템 고도화
  - 지역, 시간, 차종/난이도 기반 매칭
  - 공평 배분 알고리즘 (최근 7일 배정 적은 기사 우선)
  - 자동 수락/거절 처리
- 기사 스코어링 시스템
  - 기사 평점 및 실적 기반 스코어링
  - 스코어 기반 배정 우선순위

### 정산 자동화
- 정산 자동화 (PDF 형식)
- 정산 상태 자동 업데이트
- 정산 알림 시스템

### 고객 경험 개선
- 후기 및 평점 시스템
- 쿠폰 및 프로모션 관리
- 고객 마이페이지 고도화

### 운영 효율화
- 대시보드 통계 고도화
- 유입경로 통계 및 분석
- 자동차 모델 스크래핑 시스템

## V3 (확장 및 고급 기능)

### AI 및 분석 기능
- AI 요약 레포트 생성
- 차량 시세/리스크 자동 분석
- 데이터 기반 인사이트 제공

### B2B 확장
- 딜러/경매장 전용 기능
- B2B API 제공
- 파트너 시스템 연동

### 외부 파트너 연동
- 중고차 플랫폼 API 연동
- 딜러 네트워크 연동

# Logical Dependency Chain

## Phase 1: 기반 인프라 구축 (Foundation)
이 단계는 모든 기능의 기반이 되는 핵심 인프라를 구축합니다.

1. **사용자 인증 시스템**
   - JWT 기반 인증 구현
   - 사용자 타입별 권한 관리 (고객, 기사, 운영자, 관리자)
   - 전화번호 인증 시스템

2. **데이터베이스 스키마 설계 및 구축**
   - 사용자 테이블 (고객, 기사, 운영자)
   - 진단 신청 테이블
   - 진단 결과 테이블
   - 정산 테이블
   - 시스템 설정 테이블 (패키지, 차종별 금액, 지역 등)

3. **기본 관리자 화면**
   - 운영자/관리자 로그인 및 대시보드
   - 기본 시스템 설정 화면 (패키지, 차종별 금액, 지역 등록)

## Phase 2: 고객 신청 프로세스 (Customer Flow)
고객이 실제로 사용할 수 있는 최소 기능을 빠르게 구현하여 가시적인 결과를 만듭니다.

4. **고객 신청 화면**
   - 차량 정보 입력 (국토교통부 API 연동)
   - 패키지 선택
   - 결제 시스템 연동

5. **결제 처리 및 알림**
   - 결제 API 연동
   - 결제 완료 시 알림 발송 (알림톡, SMS, 이메일)

6. **고객 상태 조회 화면**
   - 신청 상태 실시간 조회
   - 마이페이지 기본 기능

## Phase 3: 운영자 관리 기능 (Admin Management)
운영자가 신청을 관리하고 기사를 배정할 수 있는 기능을 구현합니다.

7. **신청 관리 화면**
   - 신청 리스트 조회 및 필터링
   - 신청 상세보기
   - 기사 수동 배정 기능

8. **기사 계정 관리**
   - 기사 계정 생성 및 관리
   - 기사 정보 설정 (등급, 활동지역, 가능차종, 수수료율)

## Phase 4: 기사 진단 프로세스 (Inspector Flow)
기사가 진단을 수행하고 레포트를 작성할 수 있는 기능을 구현합니다.

9. **기사 대시보드**
   - 기사 로그인
   - 배정된 일정 확인
   - 수락/거절 기능

10. **진단 체크리스트 작성**
    - 체크리스트 입력 UI
    - 이미지 업로드 기능 (S3 연동)
    - 모바일 최적화

11. **레포트 작성 및 제출**
    - 레포트 작성 화면
    - 레포트 제출 기능
    - 운영자 검토 프로세스

## Phase 5: 레포트 발송 및 고객 조회 (Report Delivery)
레포트를 생성하고 고객에게 전달하는 기능을 구현합니다.

12. **레포트 생성 시스템**
    - 진단 결과 기반 PDF 레포트 자동 생성
    - 레포트 저장 및 관리

13. **레포트 발송**
    - 운영자 최종 발송 승인
    - 고객 이메일 자동 발송
    - 알림톡/SMS 알림

14. **고객 레포트 조회**
    - 마이페이지에서 레포트 열람
    - PDF 다운로드 기능

## Phase 6: 정산 시스템 (Settlement)
기사 정산을 위한 기본 시스템을 구현합니다.

15. **정산 데이터 기록**
    - 진단 완료 시 정산 테이블 자동 기록
    - 기사별 수수료 계산

16. **정산 관리 화면**
    - 기사별 정산 내역 조회
    - 정산 상태 관리
    - 엑셀 다운로드 기능

17. **기사 정산 조회**
    - 기사 대시보드에서 정산 내역 확인

## Phase 7: 추가 기능 및 개선 (Enhancements)
기본 기능이 완성된 후 추가 기능을 구현합니다.

18. **클레임 및 환불 처리**
    - 클레임 처리 화면
    - 환불 처리 기능

19. **통계 대시보드**
    - 기본 통계 차트
    - 신청, 결제, 매출 현황

20. **시스템 안정화 및 최적화**
    - 성능 최적화
    - 에러 처리 개선
    - 사용자 경험 개선

## 개발 우선순위 원칙
- **빠른 가시성**: Phase 2를 최우선으로 구현하여 고객이 실제로 사용할 수 있는 화면을 빠르게 만듭니다.
- **원자적 기능**: 각 기능은 독립적으로 동작하도록 설계하되, 이후 단계에서 개선할 수 있도록 확장 가능하게 구현합니다.
- **점진적 개선**: 기본 기능을 먼저 구현한 후, V2에서 자동화 및 고도화 기능을 추가합니다.

# Risks and Mitigations  

## 기술적 도전과제

### 외부 API 의존성
**리스크**: 국토교통부 API, car365 API 등 외부 API의 장애 또는 변경사항이 서비스에 영향을 줄 수 있습니다.

**완화 방안**:
- API 호출 실패 시 적절한 에러 처리 및 사용자 안내
- 외부 API 장애 시 대체 입력 방식 제공 (수동 입력)
- API 변경사항 모니터링 및 빠른 대응 체계 구축
- 캐싱 전략을 통한 API 호출 최소화

### 파일 업로드 및 저장
**리스크**: 기사가 업로드하는 이미지/영상 파일의 용량 및 보안 문제, 스토리지 비용 증가.

**완화 방안**:
- 파일 크기 제한 설정
- 이미지 압축 및 최적화
- S3 또는 유사 객체 스토리지 사용으로 확장성 확보
- 파일 업로드 보안 검증 (파일 타입, 바이러스 스캔 등)

### 알림 발송 실패
**리스크**: 알림톡, SMS, 이메일 발송 실패 시 고객 및 운영진 알림 누락.

**완화 방안**:
- 알림톡 실패 시 SMS fallback 자동 전환
- 알림 발송 실패 로그 기록 및 모니터링
- 재시도 메커니즘 구현
- 운영진 대시보드에서 알림 발송 상태 확인 기능

### 성능 및 확장성
**리스크**: 트래픽 증가 시 시스템 성능 저하, 일일 5,000건 처리 목표 달성 어려움.

**완화 방안**:
- 데이터베이스 인덱싱 최적화
- API 응답 시간 모니터링 및 최적화
- 캐싱 전략 수립 (Redis 등)
- 로드 밸런싱 및 서버 확장 계획 수립

## MVP 범위 결정

### 리스크
너무 많은 기능을 MVP에 포함하여 개발 기간이 길어지거나, 너무 적은 기능으로 인해 실제 사용 불가능한 상태가 될 수 있습니다.

### 완화 방안
- **V1 MVP 범위 명확화**: 핵심 프로세스(신청 → 배정 → 진단 → 레포트 발송)만 구현
- **수동 프로세스 허용**: V1에서는 자동 배정 대신 수동 배정으로 시작
- **기본 기능 우선**: 후기, 쿠폰 등은 V2로 미루고 핵심 기능에 집중
- **점진적 개선**: V1에서 기본 기능을 검증한 후 V2에서 고도화

## 리소스 제약

### 개발 리소스
**리스크**: 개발 인력 및 시간 부족으로 인한 일정 지연.

**완화 방안**:
- 명확한 우선순위 설정 및 단계별 개발
- 외부 라이브러리 및 서비스 활용 (결제, 알림 등)
- 재사용 가능한 컴포넌트 개발

### 운영 리소스
**리스크**: 시스템 운영 및 유지보수 인력 부족.

**완화 방안**:
- 자동화된 모니터링 및 알림 시스템 구축
- 명확한 문서화 및 운영 매뉴얼 작성
- 단계적 기능 출시로 운영 부담 최소화

## 데이터 보안 및 개인정보 보호

### 리스크
고객의 개인정보(전화번호, 이메일, 차량 정보) 및 기사 정보 유출 위험.

### 완화 방안
- 개인정보 암호화 저장
- HTTPS 통신 필수
- 접근 권한 관리 및 로그 기록
- 정기적인 보안 점검 및 취약점 검사
- 개인정보 보호법 준수

## 사용자 채택 및 학습 곡선

### 리스크
기존 "홈페이지 + 구글폼 + 슬랙 + 채널톡" 방식에 익숙한 사용자들의 새로운 시스템 적응 어려움.

### 완화 방안
- 직관적인 UI/UX 설계
- 단계별 가이드 및 도움말 제공
- 기존 프로세스와 유사한 흐름 유지
- 피드백 수집 및 빠른 개선
</PRD>


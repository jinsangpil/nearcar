"""
공공데이터포털 API 서비스
행정안전부 행정구역 코드 기반 시군구 정보 조회
"""
from typing import List, Dict, Any, Optional
import httpx
from loguru import logger
from app.core.config import settings


class PublicDataService:
    """공공데이터포털 API 서비스"""
    
    # 행정안전부 행정구역 코드 기반 시군구 목록
    # 시군구 코드는 5자리: 광역시도(2자리) + 시군구(3자리)
    CITY_CODES = {
        "11": [  # 서울특별시
            {"code": "11110", "name": "종로구"},
            {"code": "11140", "name": "중구"},
            {"code": "11170", "name": "용산구"},
            {"code": "11200", "name": "성동구"},
            {"code": "11215", "name": "광진구"},
            {"code": "11230", "name": "동대문구"},
            {"code": "11260", "name": "중랑구"},
            {"code": "11290", "name": "성북구"},
            {"code": "11305", "name": "강북구"},
            {"code": "11320", "name": "도봉구"},
            {"code": "11350", "name": "노원구"},
            {"code": "11380", "name": "은평구"},
            {"code": "11410", "name": "서대문구"},
            {"code": "11440", "name": "마포구"},
            {"code": "11470", "name": "양천구"},
            {"code": "11500", "name": "강서구"},
            {"code": "11530", "name": "구로구"},
            {"code": "11545", "name": "금천구"},
            {"code": "11560", "name": "영등포구"},
            {"code": "11590", "name": "동작구"},
            {"code": "11620", "name": "관악구"},
            {"code": "11650", "name": "서초구"},
            {"code": "11680", "name": "강남구"},
            {"code": "11710", "name": "송파구"},
            {"code": "11740", "name": "강동구"},
        ],
        "21": [  # 부산광역시
            {"code": "21110", "name": "중구"},
            {"code": "21140", "name": "서구"},
            {"code": "21170", "name": "동구"},
            {"code": "21200", "name": "영도구"},
            {"code": "21230", "name": "부산진구"},
            {"code": "21260", "name": "동래구"},
            {"code": "21290", "name": "남구"},
            {"code": "21320", "name": "북구"},
            {"code": "21350", "name": "해운대구"},
            {"code": "21380", "name": "사하구"},
            {"code": "21410", "name": "금정구"},
            {"code": "21440", "name": "강서구"},
            {"code": "21470", "name": "연제구"},
            {"code": "21500", "name": "수영구"},
            {"code": "21530", "name": "사상구"},
            {"code": "21610", "name": "기장군"},
        ],
        "22": [  # 대구광역시
            {"code": "22110", "name": "중구"},
            {"code": "22140", "name": "동구"},
            {"code": "22170", "name": "서구"},
            {"code": "22200", "name": "남구"},
            {"code": "22230", "name": "북구"},
            {"code": "22260", "name": "수성구"},
            {"code": "22290", "name": "달서구"},
            {"code": "22310", "name": "달성군"},
        ],
        "23": [  # 인천광역시
            {"code": "23110", "name": "중구"},
            {"code": "23140", "name": "동구"},
            {"code": "23170", "name": "미추홀구"},
            {"code": "23200", "name": "연수구"},
            {"code": "23230", "name": "남동구"},
            {"code": "23260", "name": "부평구"},
            {"code": "23290", "name": "계양구"},
            {"code": "23310", "name": "서구"},
            {"code": "23410", "name": "강화군"},
            {"code": "23420", "name": "옹진군"},
        ],
        "24": [  # 광주광역시
            {"code": "24110", "name": "동구"},
            {"code": "24140", "name": "서구"},
            {"code": "24170", "name": "남구"},
            {"code": "24200", "name": "북구"},
            {"code": "24230", "name": "광산구"},
        ],
        "25": [  # 대전광역시
            {"code": "25110", "name": "동구"},
            {"code": "25140", "name": "중구"},
            {"code": "25170", "name": "서구"},
            {"code": "25200", "name": "유성구"},
            {"code": "25230", "name": "대덕구"},
        ],
        "26": [  # 울산광역시
            {"code": "26110", "name": "중구"},
            {"code": "26140", "name": "남구"},
            {"code": "26170", "name": "동구"},
            {"code": "26200", "name": "북구"},
            {"code": "26230", "name": "울주군"},
        ],
        "31": [  # 경기도
            {"code": "31110", "name": "수원시"},
            {"code": "31111", "name": "수원시 영통구"},
            {"code": "31113", "name": "수원시 장안구"},
            {"code": "31115", "name": "수원시 권선구"},
            {"code": "31117", "name": "수원시 팔달구"},
            {"code": "31130", "name": "성남시"},
            {"code": "31131", "name": "성남시 수정구"},
            {"code": "31133", "name": "성남시 중원구"},
            {"code": "31135", "name": "성남시 분당구"},
            {"code": "31150", "name": "의정부시"},
            {"code": "31170", "name": "안양시"},
            {"code": "31171", "name": "안양시 만안구"},
            {"code": "31173", "name": "안양시 동안구"},
            {"code": "31190", "name": "부천시"},
            {"code": "31200", "name": "광명시"},
            {"code": "31220", "name": "평택시"},
            {"code": "31230", "name": "동두천시"},
            {"code": "31250", "name": "안산시"},
            {"code": "31253", "name": "안산시 상록구"},
            {"code": "31255", "name": "안산시 단원구"},
            {"code": "31270", "name": "고양시"},
            {"code": "31271", "name": "고양시 덕양구"},
            {"code": "31273", "name": "고양시 일산동구"},
            {"code": "31275", "name": "고양시 일산서구"},
            {"code": "31290", "name": "과천시"},
            {"code": "31310", "name": "구리시"},
            {"code": "31330", "name": "남양주시"},
            {"code": "31350", "name": "오산시"},
            {"code": "31370", "name": "시흥시"},
            {"code": "31390", "name": "군포시"},
            {"code": "31410", "name": "의왕시"},
            {"code": "31430", "name": "하남시"},
            {"code": "31450", "name": "용인시"},
            {"code": "31453", "name": "용인시 처인구"},
            {"code": "31455", "name": "용인시 기흥구"},
            {"code": "31457", "name": "용인시 수지구"},
            {"code": "31470", "name": "파주시"},
            {"code": "31490", "name": "이천시"},
            {"code": "31510", "name": "안성시"},
            {"code": "31530", "name": "김포시"},
            {"code": "31550", "name": "화성시"},
            {"code": "31570", "name": "광주시"},
            {"code": "31590", "name": "양주시"},
            {"code": "31610", "name": "포천시"},
            {"code": "31630", "name": "여주시"},
            {"code": "31710", "name": "연천군"},
            {"code": "31720", "name": "가평군"},
            {"code": "31730", "name": "양평군"},
        ],
        "33": [  # 강원특별자치도
            {"code": "33110", "name": "춘천시"},
            {"code": "33130", "name": "원주시"},
            {"code": "33150", "name": "강릉시"},
            {"code": "33170", "name": "동해시"},
            {"code": "33190", "name": "태백시"},
            {"code": "33210", "name": "속초시"},
            {"code": "33230", "name": "삼척시"},
            {"code": "33250", "name": "홍천군"},
            {"code": "33270", "name": "횡성군"},
            {"code": "33290", "name": "영월군"},
            {"code": "33310", "name": "평창군"},
            {"code": "33320", "name": "정선군"},
            {"code": "33330", "name": "철원군"},
            {"code": "33340", "name": "화천군"},
            {"code": "33350", "name": "양구군"},
            {"code": "33360", "name": "인제군"},
            {"code": "33370", "name": "고성군"},
            {"code": "33380", "name": "양양군"},
        ],
        "34": [  # 충청북도
            {"code": "34110", "name": "청주시"},
            {"code": "34111", "name": "청주시 상당구"},
            {"code": "34113", "name": "청주시 서원구"},
            {"code": "34115", "name": "청주시 흥덕구"},
            {"code": "34117", "name": "청주시 청원구"},
            {"code": "34130", "name": "충주시"},
            {"code": "34150", "name": "제천시"},
            {"code": "34170", "name": "보은군"},
            {"code": "34190", "name": "옥천군"},
            {"code": "34210", "name": "영동군"},
            {"code": "34230", "name": "증평군"},
            {"code": "34250", "name": "진천군"},
            {"code": "34270", "name": "괴산군"},
            {"code": "34290", "name": "음성군"},
            {"code": "34310", "name": "단양군"},
        ],
        "35": [  # 충청남도
            {"code": "35110", "name": "천안시"},
            {"code": "35111", "name": "천안시 동남구"},
            {"code": "35113", "name": "천안시 서북구"},
            {"code": "35130", "name": "공주시"},
            {"code": "35150", "name": "보령시"},
            {"code": "35170", "name": "아산시"},
            {"code": "35190", "name": "서산시"},
            {"code": "35210", "name": "논산시"},
            {"code": "35230", "name": "계룡시"},
            {"code": "35250", "name": "당진시"},
            {"code": "35270", "name": "금산군"},
            {"code": "35290", "name": "부여군"},
            {"code": "35310", "name": "서천군"},
            {"code": "35330", "name": "청양군"},
            {"code": "35350", "name": "홍성군"},
            {"code": "35370", "name": "예산군"},
            {"code": "35380", "name": "태안군"},
        ],
        "36": [  # 전라북도
            {"code": "36110", "name": "전주시"},
            {"code": "36111", "name": "전주시 완산구"},
            {"code": "36113", "name": "전주시 덕진구"},
            {"code": "36130", "name": "군산시"},
            {"code": "36150", "name": "익산시"},
            {"code": "36170", "name": "정읍시"},
            {"code": "36190", "name": "남원시"},
            {"code": "36210", "name": "김제시"},
            {"code": "36230", "name": "완주군"},
            {"code": "36250", "name": "진안군"},
            {"code": "36270", "name": "무주군"},
            {"code": "36290", "name": "장수군"},
            {"code": "36310", "name": "임실군"},
            {"code": "36330", "name": "순창군"},
            {"code": "36350", "name": "고창군"},
            {"code": "36370", "name": "부안군"},
        ],
        "37": [  # 전라남도
            {"code": "37110", "name": "목포시"},
            {"code": "37130", "name": "여수시"},
            {"code": "37150", "name": "순천시"},
            {"code": "37170", "name": "나주시"},
            {"code": "37190", "name": "광양시"},
            {"code": "37210", "name": "담양군"},
            {"code": "37230", "name": "곡성군"},
            {"code": "37250", "name": "구례군"},
            {"code": "37270", "name": "고흥군"},
            {"code": "37290", "name": "보성군"},
            {"code": "37310", "name": "화순군"},
            {"code": "37330", "name": "장흥군"},
            {"code": "37350", "name": "강진군"},
            {"code": "37370", "name": "해남군"},
            {"code": "37390", "name": "영암군"},
            {"code": "37410", "name": "무안군"},
            {"code": "37430", "name": "함평군"},
            {"code": "37450", "name": "영광군"},
            {"code": "37470", "name": "장성군"},
            {"code": "37490", "name": "완도군"},
            {"code": "37510", "name": "진도군"},
            {"code": "37530", "name": "신안군"},
        ],
        "38": [  # 경상북도
            {"code": "38110", "name": "포항시"},
            {"code": "38111", "name": "포항시 남구"},
            {"code": "38113", "name": "포항시 북구"},
            {"code": "38130", "name": "경주시"},
            {"code": "38150", "name": "김천시"},
            {"code": "38170", "name": "안동시"},
            {"code": "38190", "name": "구미시"},
            {"code": "38210", "name": "영주시"},
            {"code": "38230", "name": "영천시"},
            {"code": "38250", "name": "상주시"},
            {"code": "38270", "name": "문경시"},
            {"code": "38290", "name": "경산시"},
            {"code": "38310", "name": "군위군"},
            {"code": "38320", "name": "의성군"},
            {"code": "38330", "name": "청송군"},
            {"code": "38340", "name": "영양군"},
            {"code": "38350", "name": "영덕군"},
            {"code": "38360", "name": "청도군"},
            {"code": "38370", "name": "고령군"},
            {"code": "38380", "name": "성주군"},
            {"code": "38390", "name": "칠곡군"},
            {"code": "38400", "name": "예천군"},
            {"code": "38410", "name": "봉화군"},
            {"code": "38420", "name": "울진군"},
            {"code": "38430", "name": "울릉군"},
        ],
        "39": [  # 경상남도
            {"code": "39110", "name": "창원시"},
            {"code": "39111", "name": "창원시 의창구"},
            {"code": "39113", "name": "창원시 성산구"},
            {"code": "39115", "name": "창원시 마산합포구"},
            {"code": "39117", "name": "창원시 마산회원구"},
            {"code": "39119", "name": "창원시 진해구"},
            {"code": "39130", "name": "진주시"},
            {"code": "39150", "name": "통영시"},
            {"code": "39170", "name": "사천시"},
            {"code": "39190", "name": "김해시"},
            {"code": "39210", "name": "밀양시"},
            {"code": "39230", "name": "거제시"},
            {"code": "39250", "name": "양산시"},
            {"code": "39270", "name": "의령군"},
            {"code": "39290", "name": "함안군"},
            {"code": "39310", "name": "창녕군"},
            {"code": "39330", "name": "고성군"},
            {"code": "39350", "name": "남해군"},
            {"code": "39370", "name": "하동군"},
            {"code": "39380", "name": "산청군"},
            {"code": "39390", "name": "함양군"},
            {"code": "39400", "name": "거창군"},
            {"code": "39410", "name": "합천군"},
        ],
        "41": [  # 제주특별자치도
            {"code": "41110", "name": "제주시"},
            {"code": "41130", "name": "서귀포시"},
        ],
        "43": [  # 세종특별자치시
            {"code": "43110", "name": "세종시"},
        ],
    }
    
    @staticmethod
    async def get_cities_by_province(province_code: str) -> List[Dict[str, Any]]:
        """
        광역시도 코드로 시군구 목록 조회
        
        Args:
            province_code: 광역시도 코드 (11, 21, 22 등)
        
        Returns:
            시군구 목록 [{"code": "11110", "name": "종로구"}, ...]
        """
        # 고정된 시군구 목록에서 조회
        cities = PublicDataService.CITY_CODES.get(province_code, [])
        
        if not cities:
            logger.warning(f"광역시도 코드 {province_code}에 해당하는 시군구 목록이 없습니다.")
            return []
        
        logger.info(f"광역시도 코드 {province_code}의 시군구 {len(cities)}개 조회 완료")
        return cities
    
    @staticmethod
    async def get_all_provinces() -> List[Dict[str, str]]:
        """
        모든 광역시도 목록 조회
        
        Returns:
            광역시도 목록 [{"code": "11", "name": "서울특별시"}, ...]
        """
        # 고정된 광역시도 목록 반환
        provinces = [
            {"code": "11", "name": "서울특별시"},
            {"code": "21", "name": "부산광역시"},
            {"code": "22", "name": "대구광역시"},
            {"code": "23", "name": "인천광역시"},
            {"code": "24", "name": "광주광역시"},
            {"code": "25", "name": "대전광역시"},
            {"code": "26", "name": "울산광역시"},
            {"code": "31", "name": "경기도"},
            {"code": "33", "name": "강원특별자치도"},
            {"code": "34", "name": "충청북도"},
            {"code": "35", "name": "충청남도"},
            {"code": "36", "name": "전라북도"},
            {"code": "37", "name": "전라남도"},
            {"code": "38", "name": "경상북도"},
            {"code": "39", "name": "경상남도"},
            {"code": "41", "name": "제주특별자치도"},
            {"code": "43", "name": "세종특별자치시"},
        ]
        return provinces
